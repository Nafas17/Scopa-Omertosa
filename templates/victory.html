<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>ðŸŽ‰ Fine Partita - Scopa Multiplayer</title>
<link rel="stylesheet" href="/static/style.css">
<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    background-color: #f0f0f5;
    color: #333;
}
h1 { font-size: 2em; margin-bottom: 0.5em; }
h2 { margin: 0.5em 0; }
.board {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin: 10px 0 20px 0;
}
.card-img {
    width: 80px;
    margin: 5px;
    border-radius: 8px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
}
.scoreboard {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
}
.player-section {
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 8px;
    background-color: #fff;
    width: 45%;
}
</style>
</head>
<body>

<h1>ðŸŽ‰ Fine Partita!</h1>
<h2 id="winner">Calcolo in corso...</h2>

<div class="scoreboard">
    <div class="player-section">
        <h3>Tu</h3>
        <p><b>Punti:</b> <span id="your_points">0</span></p>
        <h4>Carte prese</h4>
        <div id="your_cards" class="board"></div>
    </div>

    <div class="player-section">
        <h3>Avversario</h3>
        <p><b>Punti:</b> <span id="opp_points">0</span></p>
        <h4>Carte prese</h4>
        <div id="opp_cards" class="board"></div>
    </div>
</div>

<script>
let player_id = localStorage.getItem("player_id");
let game_id = localStorage.getItem("game_id"); // assumiamo che sia salvato

let deck = [];

// Carica JSON carte
async function loadDeck() {
    const r = await fetch("/static/cards.json");
    deck = await r.json();
}

// Ottieni percorso immagine
function cardImg(card) {
    const found = deck.find(c => c.value === card[0] && c.suit === card[1]);
    return found ? found.img : "/static/back.jpg";
}

// Carica stato finale
async function loadVictory() {
    try {
        const r = await fetch(`/state/${game_id}/${player_id}`);
        const d = await r.json();

        // Punti
        const yourPoints = d.score.player1;
        const oppPoints = d.score.player2;

        document.getElementById("your_points").innerText = yourPoints;
        document.getElementById("opp_points").innerText = oppPoints;

        // Determina vincitore
        let winnerText = "";
        if (yourPoints > oppPoints) winnerText = "ðŸŽ‰ Hai vinto!";
        else if (yourPoints < oppPoints) winnerText = "ðŸ˜¢ Hai perso...";
        else winnerText = "ðŸ¤ Pareggio!";
        document.getElementById("winner").innerText = winnerText;

        // Carte prese
        const yourCardsDiv = document.getElementById("your_cards");
        const oppCardsDiv = document.getElementById("opp_cards");

        yourCardsDiv.innerHTML = "";
        oppCardsDiv.innerHTML = "";

        d.player_taken.forEach(c => {
            const img = document.createElement("img");
            img.src = cardImg(c);
            img.classList.add("card-img");
            yourCardsDiv.appendChild(img);
        });

        d.opponent_taken.forEach(c => {
            const img = document.createElement("img");
            img.src = cardImg(c);
            img.classList.add("card-img");
            oppCardsDiv.appendChild(img);
        });

    } catch(err) {
        console.error(err);
    }
}

// Avvio
(async ()=>{
    await loadDeck();
    await loadVictory();
})();
</script>

</body>
</html>
